CREATE SCHEMA SA AUTHORIZATION SA;

CREATE TABLE GROUPS(
  id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
  active boolean NOT NULL,
  name varchar(255) DEFAULT NULL,
  startDate date DEFAULT NULL,
  REPOSITORY_URL varchar(255) DEFAULT NULL,
  code varchar(200) DEFAULT NULL,
  PRIMARY KEY (id),
  UNIQUE (name)
);

CREATE TABLE SPRINTS (
  id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
  active boolean DEFAULT NULL,
  name varchar(255) DEFAULT NULL,
  sprint_type varchar(255) DEFAULT NULL,
  endDate date DEFAULT NULL,
  PRIMARY KEY (id),
  UNIQUE (name)
);

CREATE TABLE TASK_TEMPLATES (
  id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
  MODULE_SUFFIX varchar(20) DEFAULT '''''',
  materials LONG VARCHAR,
  name varchar(255) DEFAULT NULL,
  taskText varchar(20000) DEFAULT NULL,
  testName varchar(255) DEFAULT NULL,
  type varchar(255) DEFAULT NULL,
  sprint_id integer DEFAULT NULL,
  TASK_TEMPLATE_ID integer DEFAULT NULL,
  className varchar(50) DEFAULT '',
  PRIMARY KEY (id),
--   KEY FK8D1B98DF7594A635 (sprint_id),
--   KEY FK8D1B98DFCE63B41B (TASK_TEMPLATE_ID),
  CONSTRAINT FK8D1B98DF7594A635 FOREIGN KEY (sprint_id) REFERENCES SPRINTS (id),
  CONSTRAINT FK8D1B98DFCE63B41B FOREIGN KEY (TASK_TEMPLATE_ID) REFERENCES SPRINTS (id)
);

CREATE TABLE USERS (
  id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
  LOGIN varchar(255) DEFAULT NULL,
  PASSWORD varchar(255) DEFAULT NULL,
  REGISTER_DATE date NOT NULL,
  MAIL varchar(30) DEFAULT NULL,
  IGNORE_STATISTIC boolean DEFAULT NULL,
  PRIMARY KEY (id),
  UNIQUE (LOGIN)
);

CREATE TABLE TASKS (
  id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
  code LONG VARCHAR,
  result LONG VARCHAR,
  status varchar(255) DEFAULT NULL,
  group_id integer DEFAULT NULL,
  sprint_id integer DEFAULT NULL,
  template_id integer DEFAULT NULL,
  user_id integer DEFAULT NULL,
  PRIMARY KEY (id),
--   KEY FK4BE836ED05FEF55 (user_id),
--   KEY FK4BE836E7594A635 (sprint_id),
--   KEY FK4BE836E68E4073F (group_id),
--   KEY FK4BE836EA039169A (template_id),
  CONSTRAINT FK4BE836E68E4073F FOREIGN KEY (group_id) REFERENCES GROUPS (id),
  CONSTRAINT FK4BE836E7594A635 FOREIGN KEY (sprint_id) REFERENCES SPRINTS (id),
  CONSTRAINT FK4BE836EA039169A FOREIGN KEY (template_id) REFERENCES TASK_TEMPLATES (id),
  CONSTRAINT FK4BE836ED05FEF55 FOREIGN KEY (user_id) REFERENCES USERS (id)
);

CREATE TABLE TASKS_HISTORY (
  id integer NOT NULL GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1),
  code varchar(5000) DEFAULT NULL,
  date date DEFAULT NULL,
  result varchar(200) DEFAULT NULL,
  userName varchar(20) DEFAULT NULL,
  template_id integer DEFAULT NULL,
  hash varchar(50) DEFAULT NULL,
  PRIMARY KEY (id),
--   KEY FKF8E4CA3A039169A (template_id),
  CONSTRAINT FKF8E4CA3A039169A FOREIGN KEY (template_id) REFERENCES TASK_TEMPLATES (id)
);



CREATE TABLE USERS_GROUPS (
  users_id integer NOT NULL,
  groups_id integer NOT NULL,
  PRIMARY KEY (users_id,groups_id),
--   KEY FKF71B400BF25EE7CA (groups_id),
--   KEY FKF71B400BC950C7F8 (users_id),
  CONSTRAINT FKF71B400BC950C7F8 FOREIGN KEY (users_id) REFERENCES USERS (id),
  CONSTRAINT FKF71B400BF25EE7CA FOREIGN KEY (groups_id) REFERENCES GROUPS (id)
);

CREATE TABLE USERS_SPRINTS (
  users_id integer NOT NULL,
  sprints_id integer NOT NULL,
  PRIMARY KEY (users_id,sprints_id),
--   KEY FK63D2A222724BC256 (sprints_id),
--   KEY FK63D2A222C950C7F8 (users_id),
  CONSTRAINT FK63D2A222724BC256 FOREIGN KEY (sprints_id) REFERENCES SPRINTS (id),
  CONSTRAINT FK63D2A222C950C7F8 FOREIGN KEY (users_id) REFERENCES USERS (id)
);

CREATE TABLE User_roles (
  User_id integer NOT NULL,
  roles varchar(32) NOT NULL,
  PRIMARY KEY (User_id,roles),
--   KEY FKEA147569D05FEF55 (User_id),
  CONSTRAINT FKEA147569D05FEF55 FOREIGN KEY (User_id) REFERENCES USERS (id)
);